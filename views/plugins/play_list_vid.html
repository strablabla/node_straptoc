<script>

/*

Play list

*/

var list_play_state = $('<img/>').attr('src',"capicon/svg/044.svg")  // icon for play_list on/off
list_play_state.css({
                'position':'fixed',
                'top':'70px',
                'right':'20px',
                'width':'15px'
              })
$('#content').append(list_play_state)

list_play_state.click(function(event) {


      $('#id_view_image').hide()       // prenvent the browser to open the svg..
      $('#id_view_image_body').hide()   //
      //-------
      $('#hover_play_list').toggle()
      if ($('#hover_play_list').is(':visible')){
          $('#vid_play_list').show()
      }
      else{
          $('#vid_play_list').hide()
      }

  });

var img_helmet = $('<img/>').attr('src',"capicon/svg/227.svg")
img_helmet.css({'position':'relative',
                'margin-top':'25px',
                'margin-left':'50%',
                'left':'-12.5px',
                'width':'15px'
              })

var butt_play = $('<input/>').attr({   // save button
         type: "button",
         id: "butt_play",
         value: "play",
         class: "btn btn-warning"
     });
butt_play.css({'position':'absolute',
                'bottom':'30px',
                'margin-left':'50%',
                'left':'-30px',
                'padding-bottom':'5px'
              })

var hover_play_list = $('<div/>').attr('id','hover_play_list')   // small square for hovering..
hover_play_list.css({'background-color':'rgb(225,204,252)',       // hover for viewing list of vids
          'box-shadow': '0.5em 0.5em 0.7em',
          'position': 'fixed',
          'right': '5px',
          'bottom': '30px',
          'width': '20px',
          'height': '20px',
          'z-index': '3'
          })
$('#content').append(hover_play_list)

var elem0 = $('<div/>').attr('id','vid_play_list')
$('#content').append(elem0)
elem0.css({'background-color':'rgb(225,204,252, 0.9)', // Current play list..
          'box-shadow': '0.5em 0.5em 0.7em',
          'padding-bottom': '90px',
          'padding-top': '10px',
          'padding-left': '50px',
          'padding-right': '50px',
          'position': 'fixed',
          'right': '30px',
          'bottom': '70px',
          'width': 'auto',
          'height': 'auto',
          'z-index': '3'
          })
var tit = $('<h3/>').css({'text-align':'center'})
                    .text('selected medias')

$('#vid_play_list').append(img_helmet) // pict helmet
$('#vid_play_list').append(tit) // title
$('#vid_play_list').append(butt_play)  // button for playing..

function reinit_act(selection, elem, action){

  /*

  Reinitialize elem with action..

  */

  elem.each(function(){
        if( $(this).attr('index') != selection.attr('index') ){
              eval(action)
        }
   })
}

function reinitialize(sel){

  /*

  Reinitialize

  */

  reinit_act(sel, $('.vid_selected'),'$(this)[0].pause()')
  reinit_act(sel, $('.elem_list_play_selected'),"$(this).css({'color':'black'})")
  reinit_act(sel, $('.ul_selected'),'$(this).hide()')

}

function selection_click(elem_li, selection, numsel){

      /*

      Actions produced when clicking the element of the play_list..

      */

      selection.click(function(){
           reinitialize($(this))
           var currid = $(this).attr('id').split('sel_')[1] // vid current id ..
           var currvidid = '#' + currid
           var sel_vid = $(currvidid)[0]
           if (sel_vid.paused){                      // if video stopped.
               selection.css({'color':'blue'})
               //sel_vid.play()                        // play selected video..
               play_vid_list(numsel)
             }else{                                  // if video active..
              selection.css({'color':'black'})
              sel_vid.pause()
            }
            //elem_li.children('ul').toggle()             // toggle the media..
      })


}

function fill_play_list(elem_li, vid_id, numsel){

      /*

      Create the play_list..

      */

      var currid = 'vid_num' + numsel
      var selection = $('<div/>')
      selection.addClass('elem_list_play_selected').attr('index', numsel)
              .attr('src', vid_id)
              .attr('id', 'sel_' + currid)
              .text('...' + vid_id.slice(-30,-4))
      $('#vid_play_list').append(selection)     // add media title to the play list..
      selection_click(elem_li, selection, numsel)

}

var list_vid = [] // list of videos fingerprint..
var list_icons = []
var numsel = 0
$("li").click( function(){
    var elem_li = $(this)
    var vid = elem_li.find('ul li div video')
    if ( vid ){
        if(elem_li.children('ul').hasClass('strapvid')){  // filter the li element..
            var vid_id = vid.attr('src')
            if (list_vid.indexOf(vid_id) == -1){
                elem_li.children('ul').addClass('ul_selected')
                                      .attr('index', numsel)
                vid.attr('id', 'vid_num' + numsel)
                   .attr('index', numsel)             // number associated to the video..
                   .addClass('vid_selected')          // assigning class vid_selected to all the video selected..
                elem_li.css({'color':'black'})        // color the link in the main document
                list_icons[numsel] = $('<img/>').attr('src',"capicon/svg/227.svg")
                                                .css({'width':'12px', 'margin':'0px'})
                elem_li.append($('<span/>').text(' ').append(list_icons[numsel]))
                list_vid.push(vid_id)                 // save the videos id to avoid doublons.
                //-----------
                fill_play_list(elem_li, vid_id, numsel)
            }
            numsel += 1
       }
    } // end if vid
})

$('#vid_play_list').hide()
$('#hover_play_list').hide()

$('#hover_play_list').on('click', function(){  // show / hide play_list
     $('#vid_play_list').toggle() // mouseover
})

function play_vid_list(i){

      vid_id = '#vid_num' + i
      var currvid = $(vid_id)[0]
      currvid.play()
      var curr_ul;
      $('.strapvid').each(function(){
          if ($(this).attr('index') == i){
               $(this).toggle()
               curr_ul = $(this)
           }
        })
      $('#sel_vid_num' + i).css({'color':'blue'})
      $(vid_id).on('ended',function(){

            try{
                reinitialize($('#sel_vid_num' + i))
                reinitialize($('#sel_vid_num' + i-1))
                play_vid_list(i+1)     // recurrence
              }catch(err){
                //alert('enddd!!!')
              }
      })
}

$('#butt_play').click(function(){

    play_vid_list(0)

})


</script>
